<section class="md:w-[%80] mx-auto dark:bg-gray-800 min-h-[calc(100vh-8rem)] z-20">
    <section class="py-5 w-[88%] mx-auto flex flex-col items-center">
        <!-- Search input -->
        <div class="relative w-[70%] mx-auto">
            <input [(ngModel)]="searchVal" type="text" id="simple-search"
                class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-600 focus:border-blue-600 block w-full ps-10 p-2.5  dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-600 dark:focus:border-blue-600"
                placeholder="Search products..." />
        </div>
        <!-- Sort dropdown -->
        <div class="my-4 ">
            <label for="sort" class="mr-2 text-gray-700 dark:text-gray-300">Sort by:</label>
            <select id="sort" (change)="onSortChange($event)"
                class="p-2 bg-gray-50 rounded-lg border border-gray-300 dark:bg-gray-800 dark:text-white focus:ring-blue-600 focus:border-blue-600">
                <option value="">Default</option>
                <option value="name-asc">Name (A–Z)</option>
                <option value="name-desc">Name (Z–A)</option>
                <option value="price-asc">Price (Low–High)</option>
                <option value="price-desc">Price (High–Low)</option>
            </select>
        </div>
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-3 ">
            <!-- API Fallback UI -->
            @if (hasError) {
            <div
                class="z-10 fixed inset-0 flex flex-col items-center justify-center my-auto text-center py-10 text-xl text-red-500 dark:text-red-400">
                <p>❌ Failed to load products.</p>
                <button (click)="getAllProducts()"
                    class="mt-4 px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600">
                    Retry
                </button>
            </div>
            }
            <!-- All Products -->
            @else {
            @for (product of sortedProducts | filter : searchVal; track $index) {
            <div role="button" [routerLink]="['/products', product.id]"
                class="p-3 transition-transform duration-200 bg-white  hover:scale-105 dark:bg-gray-800">
                <div class="h-full p-3 rounded bg-slate-200 dark:bg-slate-700">
                    <div class="relative w-full md:overflow-hidden md:h-60 group">
                        <img [src]="product.image" class="object-contain size-full" [alt]="product.title">
                    </div>
                    <p class="my-3 truncate dark:text-white">{{product.title.split(' ').splice(0, 4).join(' ')}}</p>
                    <div class="flex items-center justify-between">
                        <div class="dark:text-white">
                            <span>{{ product.price | currency:'EGP' }}</span>
                        </div>
                        <div class="flex items-center justify-between">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"
                                class="size-5 text-yellow-300">
                                <path fill-rule="evenodd"
                                    d="M10.788 3.21c.448-1.077 1.976-1.077 2.424 0l2.082 5.006 5.404.434c1.164.093 1.636 1.545.749 2.305l-4.117 3.527 1.257 5.273c.271 1.136-.964 2.033-1.96 1.425L12 18.354 7.373 21.18c-.996.608-2.231-.29-1.96-1.425l1.257-5.273-4.117-3.527c-.887-.76-.415-2.212.749-2.305l5.404-.434 2.082-5.005Z"
                                    clip-rule="evenodd" />
                            </svg>
                            <span class="dark:text-white pe-1">{{product.rating.rate}}</span>
                            <span class="text-slate-500 dark:text-slate-400">({{product.rating.count}})</span>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Empty State (no data from API) -->
            }@empty {
            <div
                class="fixed inset-0 flex items-center justify-center my-auto  h-[calc(100vh-17.5rem)] text-xl text-gray-700 dark:text-gray-400">
                <span class="animate-pulse">No products matched your search.</span>
            </div>
            }
            }
        </div>
    </section>
</section>